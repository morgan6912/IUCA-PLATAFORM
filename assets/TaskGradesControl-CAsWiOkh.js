import{d as G,e as s,a1 as L,j as e,a4 as U}from"./index-C4aqFuzc.js";import{l as E}from"./userService-DLJmcfev.js";import"./authService-BRFCedW7.js";const M=()=>{const{showToast:m}=G(),[c,v]=s.useState([]),[f,y]=s.useState([]),[C,b]=s.useState(!0),[d,w]=s.useState("all"),[p,S]=s.useState(""),[n,i]=s.useState({id:"",value:""}),[k,N]=s.useState(!1),o=s.useCallback(()=>{b(!0),L().then(t=>v(t)).finally(()=>b(!1))},[]);s.useEffect(()=>{o(),E().then(y)},[o]);const h=s.useCallback(t=>{var a;return((a=f.find(l=>l.id===t))==null?void 0:a.name)||"Usuario"},[f]),x=s.useMemo(()=>{const t=c.length,a=c.filter(r=>r.status==="calificado").length,l=t-a,g=a>0?(c.filter(r=>typeof r.grade=="number").reduce((r,u)=>r+(u.grade||0),0)/a).toFixed(1):"--";return{total:t,graded:a,pending:l,avgGrade:g}},[c]),j=s.useMemo(()=>{const t=p.toLowerCase();return c.filter(a=>{var r,u;const l=d==="all"||a.status===d,g=!t||((r=a.title)==null?void 0:r.toLowerCase().includes(t))||((u=a.assignmentTitle)==null?void 0:u.toLowerCase().includes(t))||h(a.userId).toLowerCase().includes(t);return l&&g}).sort((a,l)=>new Date(l.submittedAt).getTime()-new Date(a.submittedAt).getTime())},[c,d,p,h]),T=t=>{var a;i({id:t.id,value:((a=t.grade)==null?void 0:a.toString())||""})},D=()=>i({id:"",value:""}),A=async()=>{if(!n.id)return;const t=Number(n.value);if(Number.isNaN(t)||t<0||t>10){m("Ingresa una calificación entre 0 y 10.","error");return}N(!0);try{await U(n.id,t),m("Calificación guardada.","success"),i({id:"",value:""}),o()}catch{m("No se pudo guardar la calificación.","error")}finally{N(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-slate-400",children:"Docentes y Administrativos"}),e.jsx("h1",{className:"text-3xl font-bold text-slate-800",children:"Control de calificaciones de tareas"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Supervisa el estado de entrega, asigna calificaciones y detecta tareas pendientes por revisar."})]}),e.jsx("section",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[{label:"Total de envíos",value:x.total,accent:"text-iuca-blue-700"},{label:"Calificados",value:x.graded,accent:"text-emerald-600"},{label:"Pendientes",value:x.pending,accent:"text-amber-600"},{label:"Promedio general",value:x.avgGrade,accent:"text-slate-700"}].map(t=>e.jsxs("div",{className:"rounded-3xl border border-slate-100 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:t.label}),e.jsx("p",{className:`text-3xl font-semibold ${t.accent}`,children:t.value})]},t.label))}),e.jsxs("section",{className:"rounded-3xl border border-slate-100 bg-white p-6 shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("input",{type:"text",placeholder:"Buscar por título, alumno o asignación...",value:p,onChange:t=>S(t.target.value),className:"flex-1 rounded-2xl border border-slate-200 px-4 py-2 text-sm focus:border-iuca-blue-500 focus:ring-2 focus:ring-iuca-blue-200"}),e.jsxs("select",{value:d,onChange:t=>w(t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 text-sm focus:border-iuca-blue-500 focus:ring-2 focus:ring-iuca-blue-200",children:[e.jsx("option",{value:"all",children:"Todos"}),e.jsx("option",{value:"enviado",children:"Enviados"}),e.jsx("option",{value:"calificado",children:"Calificados"})]}),e.jsx("button",{type:"button",onClick:o,className:"rounded-2xl border border-slate-200 px-4 py-2 text-sm text-slate-600 hover:border-iuca-blue-400",children:"Actualizar"})]}),C?e.jsx("p",{className:"text-sm text-slate-500",children:"Cargando tareas..."}):j.length===0?e.jsx("p",{className:"text-sm text-slate-500",children:"No hay tareas que coincidan con la búsqueda."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-slate-600",children:[e.jsx("thead",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Alumno"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Tarea"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Archivo"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Fecha envío"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Calificación"})]})}),e.jsx("tbody",{children:j.map(t=>e.jsxs("tr",{className:"border-t border-slate-100",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"font-semibold text-slate-800",children:h(t.userId)}),e.jsxs("p",{className:"text-xs text-slate-400",children:["ID: ",t.userId]})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"font-medium text-slate-700",children:t.assignmentTitle||t.title}),t.assignmentDue&&e.jsxs("p",{className:"text-xs text-slate-400",children:["Vence: ",new Date(t.assignmentDue).toLocaleDateString()]})]}),e.jsx("td",{className:"px-4 py-3 text-xs",children:t.fileUrl?e.jsx("button",{type:"button",onClick:()=>window.open(t.fileUrl,"_blank","noopener,noreferrer"),className:"text-iuca-blue-600 hover:text-iuca-blue-500 font-semibold underline",children:t.fileName||"Ver archivo"}):e.jsx("span",{className:"text-slate-400",children:"Sin archivo"})}),e.jsx("td",{className:"px-4 py-3 text-xs text-slate-500",children:new Date(t.submittedAt).toLocaleString()}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-semibold uppercase tracking-[0.3em] ${t.status==="calificado"?"bg-emerald-50 text-emerald-700":"bg-amber-50 text-amber-700"}`,children:t.status})}),e.jsx("td",{className:"px-4 py-3",children:n.id===t.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:0,max:10,step:.1,value:n.value,onChange:a=>i(l=>({...l,value:a.target.value})),className:"w-24 rounded-xl border border-slate-200 px-2 py-1 text-sm focus:border-iuca-blue-500 focus:ring-2 focus:ring-iuca-blue-200"}),e.jsx("button",{type:"button",onClick:A,disabled:k,className:"rounded-full bg-gradient-to-r from-iuca-green-600 to-iuca-blue-600 px-3 py-1 text-xs font-semibold text-white shadow",children:"Guardar"}),e.jsx("button",{type:"button",onClick:D,className:"rounded-full border border-slate-200 px-3 py-1 text-xs text-slate-500",children:"Cancelar"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-semibold text-slate-700",children:typeof t.grade=="number"?t.grade:"--"}),e.jsx("button",{type:"button",onClick:()=>T(t),className:"text-xs font-semibold text-iuca-blue-600 hover:text-iuca-blue-500",children:t.status==="calificado"?"Editar":"Calificar"})]})})]},t.id))})]})})]})]})};export{M as default};
