import{u as S,d as A,r as l,w as R,x as E,R as v,j as e}from"./index-C4aqFuzc.js";import{D as F}from"./download-lqvHWmM-.js";const f=r=>{switch(r){case"aprobado":return"Aprobado";case"rechazado":return"Rechazado";default:return"Pendiente"}},L=r=>{switch(r){case"aprobado":return"text-emerald-600 bg-emerald-50 border border-emerald-200";case"rechazado":return"text-rose-600 bg-rose-50 border border-rose-200";default:return"text-amber-600 bg-amber-50 border border-amber-200"}},$=()=>{const{user:r}=S(),{showToast:p}=A(),[o,y]=l.useState([]),[k,j]=l.useState(!0),[a,c]=l.useState(null),[h,D]=l.useState(""),[i,C]=l.useState("all"),[b,N]=l.useState({}),x=l.useCallback(async()=>{j(!0);const s=await R();y(s),j(!1)},[]);l.useEffect(()=>{x()},[x]);const m=l.useMemo(()=>({total:o.length,pending:o.filter(s=>s.status==="pendiente").length,approved:o.filter(s=>s.status==="aprobado").length,denied:o.filter(s=>s.status==="rechazado").length}),[o]),g=l.useMemo(()=>{const s=h.trim().toLowerCase();return o.filter(t=>i==="all"?!0:t.status===i).filter(t=>!s||t.userName.toLowerCase().includes(s)||t.fileName.toLowerCase().includes(s)).sort((t,n)=>new Date(n.uploadedAt).getTime()-new Date(t.uploadedAt).getTime())},[o,i,h]),u=l.useCallback(async(s,t)=>{if(!r)return;const n=b[s];await E(s,t,r.id,r.name,n)&&(p(`Documento ${t==="aprobado"?"aprobado":"rechazado"}.`,"success"),N(T=>{const w={...T};return delete w[s],w}),await x())},[r,x,p,b]),z=s=>{const t=s.download_url||s.downloadUrl||s.dataUrl;if(!t){p("No hay archivo disponible para descargar.","info");return}if(!window.open(t,"_blank","noopener,noreferrer")){const d=document.createElement("a");d.href=t,d.download=s.fileName||"documento",d.target="_blank",d.rel="noopener noreferrer",d.click()}};return!r||r.role!==v.ADMINISTRATIVO&&r.role!==v.DIRECTIVO?null:e.jsxs("div",{className:"space-y-6",children:[e.jsx("section",{className:"rounded-3xl border border-emerald-100 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-emerald-500",children:"Revisión de documentos"}),e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"Documentos de inscripción"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Aprobar o rechazar los archivos de matrícula cargados por los estudiantes."})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm text-slate-500",children:[e.jsxs("span",{children:["Pendientes: ",e.jsx("strong",{className:"text-amber-600",children:m.pending})]}),e.jsxs("span",{children:["Aprobados: ",e.jsx("strong",{className:"text-emerald-600",children:m.approved})]}),e.jsxs("span",{children:["Rechazados: ",e.jsx("strong",{className:"text-rose-600",children:m.denied})]}),e.jsxs("span",{children:["Total: ",e.jsx("strong",{className:"text-slate-900",children:m.total})]})]})]})}),e.jsx("section",{className:"space-y-6",children:k?e.jsx("p",{className:"text-sm text-slate-500",children:"Cargando documentos…"}):o.length?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap gap-3 items-center justify-between",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Filtro"}),["all","pendiente","aprobado","rechazado"].map(s=>e.jsx("button",{type:"button",onClick:()=>C(s),className:`px-3 py-1 text-xs font-semibold rounded-full border ${i===s?"border-emerald-500 bg-emerald-50 text-emerald-600":"border-slate-200 bg-white text-slate-600 hover:border-slate-300"}`,children:s==="all"?"Todos":f(s)},s))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"search",value:h,onChange:s=>D(s.target.value),placeholder:"Buscar estudiante o archivo",className:"text-sm border border-slate-200 rounded-full px-3 py-1 focus:border-emerald-500 focus:outline-none"}),e.jsx(F,{className:"h-4 w-4 text-slate-400"})]})]}),g.length?e.jsx("div",{className:"space-y-4",children:g.map(s=>e.jsxs("article",{className:"rounded-2xl border border-slate-100 bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:s.fileName}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Enviado por ",e.jsx("span",{className:"font-semibold text-slate-800",children:s.userName})," el"," ",new Date(s.uploadedAt).toLocaleString()]})]}),e.jsx("span",{className:`px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.3em] rounded-full border ${L(s.status)}`,children:f(s.status)})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[s.status==="pendiente"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>u(s.id,"aprobado"),className:"rounded-full border border-emerald-500 px-3 py-1 text-xs font-semibold text-emerald-600 hover:bg-emerald-50",children:"Aprobar"}),e.jsx("button",{type:"button",onClick:()=>u(s.id,"rechazado"),className:"rounded-full border border-rose-500 px-3 py-1 text-xs font-semibold text-rose-600 hover:bg-rose-50",children:"Rechazar"})]}),e.jsxs("button",{type:"button",onClick:()=>z(s),className:"rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-700 hover:bg-slate-50",title:`Archivo de ${s.userName}`,children:["Descargar (",s.userName,")"]}),s.type&&e.jsxs("span",{className:"text-xs text-slate-500",children:["Tipo: ",s.type]}),s.size&&e.jsxs("span",{className:"text-xs text-slate-500",children:["Tamaño: ",(s.size/1024).toFixed(2)," KB"]}),e.jsx("button",{type:"button",onClick:()=>c(s),className:"rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-700 hover:bg-slate-50",children:"Ver detalle"})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"text-xs text-slate-500",children:"Observación (opcional)"}),e.jsx("textarea",{rows:2,value:b[s.id]||"",onChange:t=>N(n=>({...n,[s.id]:t.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:ring-2 focus:ring-emerald-100",placeholder:"Ej. Falta firma, documento ilegible, etc."})]})]},s.id))}):e.jsx("p",{className:"text-sm text-slate-500",children:"No hay documentos que coincidan con el filtro seleccionado."})]}):e.jsx("p",{className:"text-sm text-slate-500",children:"No hay documentos guardados todavía."})}),a&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 px-4",children:e.jsxs("div",{className:"w-full max-w-lg rounded-2xl bg-white p-6 shadow-xl",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:[a.userName," · ",f(a.status)]}),e.jsx("h3",{className:"text-xl font-semibold text-slate-800",children:a.fileName})]}),e.jsx("button",{className:"text-slate-500 hover:text-slate-700",onClick:()=>c(null),children:"Cerrar"})]}),e.jsxs("div",{className:"mt-4 space-y-3 text-sm text-slate-600",children:[e.jsxs("p",{children:["Subido el ",new Date(a.uploadedAt).toLocaleString()," por ",a.userName]}),e.jsxs("p",{children:["Tipo: ",a.type]}),e.jsxs("p",{children:["Tamaño aproximado: ",(a.size/1024).toFixed(2)," KB"]}),a.reviewerRemark&&e.jsxs("p",{className:"text-slate-500",children:["Nota previa: ",a.reviewerRemark]})]}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[e.jsx("button",{onClick:()=>{u(a.id,"aprobado"),c(null)},className:"flex-1 rounded-2xl border border-emerald-300 bg-emerald-50 px-4 py-2 text-sm font-semibold text-emerald-700",children:"Aprobar y cerrar"}),e.jsx("button",{onClick:()=>{u(a.id,"rechazado"),c(null)},className:"flex-1 rounded-2xl border border-rose-300 bg-rose-50 px-4 py-2 text-sm font-semibold text-rose-700",children:"Rechazar y cerrar"})]})]})})]})};export{$ as default};
