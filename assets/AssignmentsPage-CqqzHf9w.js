import{u as Ee,d as Ce,R as xe,e as l,$ as L,a0 as me,a1 as Ae,j as e,a2 as ke,a3 as De,a4 as Te,J as Ie}from"./index-C4aqFuzc.js";import{h as $e,g as Re}from"./teacherService-BvBxNJ2F.js";import{l as Le}from"./userService-DLJmcfev.js";import"./authService-BRFCedW7.js";const Ue=()=>{var le,re;const{user:i}=Ee(),{showToast:f}=Ce(),ue=(i==null?void 0:i.role)===xe.DOCENTE,[he,pe]=l.useState([]);l.useEffect(()=>{i&&$e(i.name).then(s=>pe(s.map(t=>({id:t.id,code:t.code,name:t.name}))))},[i]);const[j,w]=l.useState([]),[E,O]=l.useState(""),[C,V]=l.useState(""),[G,J]=l.useState(""),[p,A]=l.useState(""),[F,k]=l.useState([]),[P,fe]=l.useState([]),[n,y]=l.useState([]),U="iuca-module-grades",[D,T]=l.useState([]),[S,B]=l.useState([]),[M,q]=l.useState(""),[N,X]=l.useState(""),[I,_]=l.useState(""),[z,H]=l.useState(""),[je,K]=l.useState({}),[b,Y]=l.useState(""),[Oe,Ve]=l.useState(""),[x,$]=l.useState(""),[m,W]=l.useState(null);l.useEffect(()=>{if(!x){w([]);return}L(x).then(w)},[x]),l.useEffect(()=>{if(!p){k([]);return}me(p).then(k)},[p]),l.useEffect(()=>{Ae().then(fe)},[]),l.useEffect(()=>{Le().then(s=>B(s.filter(t=>t.role===xe.ESTUDIANTE).map(t=>({id:t.id,name:t.name,email:t.email})))).catch(()=>B([]))},[]),l.useEffect(()=>{if(i)try{const s=typeof window<"u"?window.localStorage.getItem(MODULE_ASSIGN_KEY):null,a=(s?JSON.parse(s):[]).map(c=>({...c,studentIds:Array.isArray(c.studentIds)?c.studentIds:[]})),r=c=>i?c.profesorId===i.id?!0:!c.profesorNombre||!i.name?!1:c.profesorNombre.trim().toLowerCase()===i.name.trim().toLowerCase():!1;y(a.filter(r))}catch{y([])}},[i]),l.useEffect(()=>{if(!n.length){$("");return}(!x||!n.some(s=>s.id===x))&&$(n[0].id)},[n,x]),l.useEffect(()=>{if(!i)return;(async()=>{try{const a=(await Ie()).filter(r=>r.profesorId===i.id?!0:!r.profesorNombre||!i.name?!1:r.profesorNombre.trim().toLowerCase()===i.name.trim().toLowerCase());y(a)}catch{y([])}})()},[i]),l.useEffect(()=>{if(i)try{const s=typeof window<"u"?window.localStorage.getItem(U):null,t=s?JSON.parse(s):[];T(t)}catch{T([])}},[i]),l.useEffect(()=>{(async()=>{if(!n.length){K({}),Y("");return}const t=await Promise.all(n.map(async r=>[r.id,await Re(r.id)])),a={};t.forEach(([r,c])=>{a[r]=c}),K(a),!b&&t.length&&Y(t[0][0])})()},[n,b]);const Q=l.useMemo(()=>new Set(j.map(s=>s.id)),[j]),v=l.useMemo(()=>P.filter(s=>s.assignmentId&&Q.has(s.assignmentId)),[P,Q]),u=l.useMemo(()=>{const s=v.filter(d=>d.status==="enviado").length,t=v.filter(d=>d.status==="calificado").length,a=v.filter(d=>typeof d.grade=="number").map(d=>d.grade),r=a.length?Number((a.reduce((d,g)=>d+g,0)/a.length).toFixed(2)):null,c=[...j].map(d=>({...d,dueDateObj:new Date(d.dueDate)})).filter(d=>!Number.isNaN(d.dueDateObj.getTime())).sort((d,g)=>d.dueDateObj.getTime()-g.dueDateObj.getTime()).slice(0,3);return{totalAssignments:j.length,totalSubmissions:v.length,pending:s,graded:t,average:r,upcoming:c}},[j,v]),R=n.length,ge=s=>{T(s),typeof window<"u"&&window.localStorage.setItem(U,JSON.stringify(s))},Ne={L:"Lunes",M:"Martes",X:"Miercoles",J:"Jueves",V:"Viernes"},be={Lunes:"L",Martes:"M",Miércoles:"X",Miercoles:"X",Jueves:"J",Viernes:"V"},o=30,Z=s=>{const[t,a]=s.split(":").map(Number);return t*60+(a||0)},h=l.useMemo(()=>{const s=[];return n.forEach(t=>{t.modulo.materias.forEach(a=>{Object.entries(a.horario).forEach(([r,c])=>{const d=be[r];if(!d)return;const[g,de]=c.split("-");if(!g||!de)return;const ie=Z(g),ne=Z(de),ce=Math.floor(ie/o)*o,oe=Math.ceil(ne/o)*o,Me=Math.max(1,(oe-ce)/o);s.push({day:d,code:a.clave,name:a.nombre,start:ie,end:ne,startRow:ce,endRow:oe,rows:Me})})})}),s},[n]),[ee,se]=l.useMemo(()=>{const s=[480,1200];if(h.length===0)return s;let t=Math.min(...h.map(r=>r.start)),a=Math.max(...h.map(r=>r.end));return t=Math.max(480,Math.floor(t/o)*o),a=Math.min(1260,Math.ceil(a/o)*o),[t,a]},[h]),ve=l.useMemo(()=>{const s=[];for(let t=ee;t<=se;t+=o)s.push(t);return s},[ee,se]),te=s=>{const t=Math.floor(s/60),a=s%60,r=t>=12?"pm":"am",c=(t+11)%12+1,d=a.toString().padStart(2,"0");return`${c}:${d}${r}`},we=l.useMemo(()=>{const s=new Map;return h.forEach(t=>s.set(`${t.day}-${t.startRow}`,t)),s},[h]),ye=l.useMemo(()=>{const s=new Set;return h.forEach(t=>{for(let a=t.startRow+o;a<t.endRow;a+=o)s.add(`${t.day}-${a}`)}),s},[h]),Se=s=>{const t=["bg-emerald-100 text-emerald-800 border-emerald-300","bg-sky-100 text-sky-800 border-sky-300","bg-amber-100 text-amber-800 border-amber-300","bg-violet-100 text-violet-800 border-violet-300","bg-rose-100 text-rose-800 border-rose-300","bg-teal-100 text-teal-800 border-teal-300"];let a=0;for(let r=0;r<s.length;r++)a=a*31+s.charCodeAt(r)>>>0;return t[a%t.length]},ae=b?je[b]||[]:[];return ae.map(s=>S.find(t=>t.id===s)).filter(Boolean),S.filter(s=>!ae.includes(s.id)),n.find(s=>s.id===b),ue?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-800",children:"Gestion de modulos y tareas"}),e.jsx("p",{className:"text-sm text-slate-500 max-w-2xl",children:"Administra tus cursos, publica tareas y monitorea entregas en tiempo real desde el panel docente."})]}),e.jsx("span",{className:"text-sm text-slate-500",children:"Selecciona un curso y mantén tu ritmo académico."})]}),e.jsxs("section",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4",children:[e.jsxs("article",{className:"bg-white border border-slate-100 rounded-2xl p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Cursos"}),e.jsx("p",{className:"text-3xl font-semibold text-slate-800",children:he.length}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Cursos a tu cargo"})]}),e.jsxs("article",{className:"bg-white border border-slate-100 rounded-2xl p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Modulos asignados"}),e.jsx("p",{className:"text-3xl font-semibold text-slate-800",children:R}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"De acuerdo a FORMATO 13"})]}),e.jsxs("article",{className:"bg-white border border-slate-100 rounded-2xl p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Tareas publicadas"}),e.jsx("p",{className:"text-3xl font-semibold text-slate-800",children:u.totalAssignments}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Con fechas activas"})]}),e.jsxs("article",{className:"bg-white border border-slate-100 rounded-2xl p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Entregas pendientes"}),e.jsx("p",{className:"text-3xl font-semibold text-orange-500",children:u.pending}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Esperando revisión"})]}),e.jsxs("article",{className:"bg-white border border-slate-100 rounded-2xl p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Promedio"}),e.jsx("p",{className:"text-3xl font-semibold text-iuca-green-600",children:u.average??"---"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Basado en calificaciones"})]})]}),e.jsxs("section",{className:"bg-white p-6 rounded-xl shadow-md space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Modulos"}),e.jsx("h2",{className:"text-xl font-semibold text-slate-800",children:"Modulos academicos asignados"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Carga automatica de clave, horas, horario por dia y periodo."})]}),e.jsxs("span",{className:"text-xs text-slate-500",children:[R," modulo(s)"]})]}),R===0?e.jsx("p",{className:"text-sm text-slate-600",children:"Aun no tienes modulos asignados."}):e.jsx("div",{className:"space-y-3",children:n.map(s=>e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Profesor"}),e.jsx("p",{className:"text-sm font-semibold text-slate-800",children:s.profesorNombre})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-semibold text-slate-800",children:[s.modulo.codigo," · ",s.modulo.nombre]}),e.jsxs("p",{className:"text-xs text-slate-500",children:[s.modulo.periodo.inicio," → ",s.modulo.periodo.fin," · ",s.modulo.periodo.semanas," semanas"]})]})]}),e.jsx("div",{className:"grid gap-2 md:grid-cols-2",children:s.modulo.materias.map(t=>e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-semibold text-slate-900",children:[t.clave," · ",t.nombre]}),e.jsxs("span",{className:"text-xs text-slate-500",children:[t.horas," h"]})]}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Modalidad: ",t.modalidad," · Turno: ",t.turno," · Grupo: ",t.grupo," · Semanas: ",t.semanas]}),e.jsx("p",{className:"text-xs text-slate-500",children:Object.entries(t.horario).map(([a,r])=>`${a}: ${r}`).join(" · ")}),t.observaciones&&e.jsxs("p",{className:"text-xs text-amber-700",children:["Obs: ",t.observaciones]})]},`${s.id}-${t.clave}`))})]},s.id))})]}),e.jsxs("section",{className:"bg-white p-6 rounded-xl shadow-md space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between flex-wrap gap-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Evaluación de módulos"}),e.jsx("h2",{className:"text-xl font-semibold text-slate-800",children:"Calificar estudiantes por módulo"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Selecciona módulo y estudiante, asigna calificación y guarda."})]})}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[e.jsxs("label",{className:"flex flex-col text-sm text-slate-700",children:["Módulo",e.jsxs("select",{value:M,onChange:s=>q(s.target.value),className:"mt-1 rounded-xl border border-slate-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Elige módulo"}),n.map(s=>e.jsxs("option",{value:s.id,children:[s.modulo.codigo," · ",s.modulo.nombre]},s.id))]})]}),e.jsxs("label",{className:"flex flex-col text-sm text-slate-700",children:["Estudiante",e.jsxs("select",{value:N,onChange:s=>X(s.target.value),className:"mt-1 rounded-xl border border-slate-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Elige estudiante"}),S.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("label",{className:"flex flex-col text-sm text-slate-700",children:["Calificación",e.jsx("input",{type:"number",min:0,max:100,value:I,onChange:s=>_(s.target.value?Number(s.target.value):""),className:"mt-1 rounded-xl border border-slate-200 px-3 py-2 text-sm",placeholder:"0 - 100"})]})]}),e.jsxs("label",{className:"flex flex-col text-sm text-slate-700",children:["Observaciones",e.jsx("textarea",{value:z,onChange:s=>H(s.target.value),className:"mt-1 rounded-xl border border-slate-200 px-3 py-2 text-sm",placeholder:"Comentarios opcionales"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{if(!M||!N||I===""){f("Selecciona módulo, estudiante y calificación","error");return}const s=S.find(a=>a.id===N);if(!s){f("Estudiante no encontrado","error");return}const t=D.filter(a=>!(a.moduleId===M&&a.studentId===N));t.push({moduleId:M,studentId:N,studentName:s.name,grade:Number(I),remark:z.trim()||void 0}),ge(t),f("Calificación guardada","success")},className:"rounded-xl bg-iuca-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-iuca-blue-700",children:"Guardar calificación"}),e.jsx("button",{onClick:()=>{q(""),X(""),_(""),H("")},className:"rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-600 hover:bg-slate-100",children:"Limpiar"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-800",children:"Calificaciones registradas"}),D.length===0?e.jsx("p",{className:"text-sm text-slate-500",children:"Aún no hay calificaciones."}):e.jsx("div",{className:"space-y-1 text-sm text-slate-700",children:D.map(s=>{const t=n.find(a=>a.id===s.moduleId);return e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-slate-50 px-3 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:t?`${t.modulo.codigo} · ${t.modulo.nombre}`:s.moduleId}),e.jsx("span",{className:"text-xs text-slate-500",children:s.grade})]}),e.jsxs("p",{className:"text-xs text-slate-600",children:["Alumno: ",s.studentName]}),s.remark&&e.jsxs("p",{className:"text-xs text-slate-500",children:["Obs: ",s.remark]})]},`${s.moduleId}-${s.studentId}`)})})]})]}),e.jsxs("section",{className:"bg-white p-6 rounded-xl shadow-md space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Horario"}),e.jsx("h2",{className:"text-xl font-semibold text-slate-800",children:"Bloques semanales (modulos)"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Vista similar al horario de estudiantes, construida con los modulos asignados."})]}),h.length===0?e.jsx("p",{className:"text-sm text-slate-600",children:"Aun no hay horarios de modulos."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-slate-50",children:["L","M","X","J","V"].map(s=>e.jsx("th",{className:"px-3 py-2 text-left text-slate-600",children:Ne[s]},s))})}),e.jsx("tbody",{className:"divide-y divide-slate-200",children:ve.map(s=>e.jsx("tr",{children:["L","M","X","J","V"].map(t=>{const a=`${t}-${s}`,r=we.get(a);return r?e.jsx("td",{className:"px-3 py-2 align-top",rowSpan:r.rows,children:e.jsxs("div",{className:`border rounded p-2 ${Se(r.code)}`,children:[e.jsx("div",{className:"text-xs uppercase tracking-wide",children:r.code}),e.jsx("div",{className:"text-sm font-semibold",children:r.name}),e.jsxs("div",{className:"text-xs text-slate-700",children:[te(r.start)," - ",te(r.end)]})]})},a):ye.has(a)?null:e.jsx("td",{className:"px-3 py-2 align-top"},a)})},s))})]})})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1.2fr_0.8fr]",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wider text-slate-500",children:"Tareas por módulo"}),e.jsx("h2",{className:"text-xl font-semibold text-slate-800",children:"Crear y enviar al módulo seleccionado"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Selecciona un módulo asignado y publica la tarea para que llegue a sus estudiantes."})]}),e.jsxs("select",{value:x,onChange:s=>{$(s.target.value),A("")},className:"border border-slate-200 rounded-full px-4 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Elige un módulo..."}),n.map(s=>e.jsxs("option",{value:s.id,children:[s.modulo.codigo," - ",s.modulo.nombre]},s.id))]})]}),n.length===0?e.jsx("p",{className:"text-sm text-slate-500",children:"Aún no tienes módulos asignados. Solicita al administrador para empezar a publicar tareas."}):e.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-4 gap-2",onSubmit:async s=>{if(s.preventDefault(),!x||!E.trim()||!C){f("Completa módulo, título y fecha","error");return}await ke(x,E,C,G),O(""),V(""),J(""),w(await L(x)),f("Tarea publicada para el módulo seleccionado","success")},children:[e.jsx("input",{value:E,onChange:s=>O(s.target.value),placeholder:"Título",className:"border rounded-md p-2",required:!0}),e.jsx("input",{type:"date",value:C,onChange:s=>V(s.target.value),className:"border rounded-md p-2",required:!0}),e.jsx("input",{value:G,onChange:s=>J(s.target.value),placeholder:"Descripción (opcional)",className:"border rounded-md p-2 md:col-span-2"}),e.jsx("div",{className:"md:col-span-4",children:e.jsx("button",{className:"w-full bg-gradient-to-r from-iuca-green-600 to-iuca-blue-600 text-white px-4 py-2 rounded-md font-semibold",children:"Publicar tarea"})})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800",children:"Próximas tareas"}),e.jsxs("span",{className:"text-xs text-slate-500",children:[u.upcoming.length," próximas"]})]}),u.upcoming.length===0?e.jsx("p",{className:"text-sm text-slate-500",children:"No hay tareas próximas programadas."}):e.jsx("ul",{className:"space-y-3",children:u.upcoming.map(s=>e.jsxs("li",{className:"rounded-2xl border border-slate-100 p-3",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-800",children:s.title}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Vence: ",new Date(s.dueDate).toLocaleDateString()]}),e.jsx("p",{className:"text-xs text-slate-400",children:s.description||"Sin descripción"})]},s.id))})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Tareas publicadas"}),j.length===0?e.jsx("p",{className:"text-slate-600",children:"Aún no publicas tareas."}):e.jsx("ul",{className:"divide-y divide-slate-200",children:j.map(s=>e.jsxs("li",{className:"py-3 flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-800",children:s.title}),e.jsxs("p",{className:"text-sm text-slate-500",children:["Vence: ",new Date(s.dueDate).toLocaleDateString(),s.description?` · ${s.description}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>A(s.title),className:"text-iuca-blue-600 hover:underline text-sm font-semibold",children:"Ver entregas"}),e.jsx("button",{onClick:async()=>{await De(s.id),w(await L(x)),p===s.title&&A(""),f("Tarea eliminada","info")},className:"text-red-600 hover:underline text-sm font-semibold",children:"Eliminar"})]})]},s.id))})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-lg font-semibold text-slate-800",children:["Entregas ",p&&e.jsxs("span",{className:"text-slate-500 text-sm",children:["(",p,")"]})]}),e.jsxs("span",{className:"text-xs text-slate-500",children:[u.totalSubmissions," entregas registradas"]})]}),p?F.length===0?e.jsx("p",{className:"text-slate-600",children:"No hay entregas aún."}):e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-3 py-2",children:"Estudiante"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Archivo"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Fecha"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Calificación"}),e.jsx("th",{})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200",children:F.map(s=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-3 py-2",children:[e.jsx("p",{className:"font-medium text-slate-800",children:s.userId}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Estado: ",s.status]})]}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.fileName||"-"}),s.fileUrl&&e.jsx("button",{type:"button",className:"text-xs text-iuca-blue-600 font-semibold hover:underline",onClick:()=>W(s),children:"Ver"})]})}),e.jsx("td",{className:"px-3 py-2",children:new Date(s.submittedAt).toLocaleString()}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"number",min:0,max:10,defaultValue:s.grade??"",className:"w-20 border rounded p-1",id:`grade-${s.id}`})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("button",{onClick:async()=>{const t=document.getElementById(`grade-${s.id}`).value,a=Number(t);isNaN(a)||(await Te(s.id,a),k(await me(p)),f("Calificación guardada","success"))},className:"text-iuca-green-700 hover:underline text-sm font-semibold",children:"Guardar"})})]},s.id))})]})}):e.jsx("p",{className:"text-slate-600",children:"Selecciona una tarea para revisar entregas."}),e.jsx("div",{className:"mt-4 text-xs text-slate-500",children:u.average!==null?`Promedio de entregas calificadas: ${u.average}`:"Aún no hay calificaciones registradas."})]})})]})]}),m&&e.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-slate-900/70 px-4",children:e.jsxs("div",{className:"w-full max-w-4xl rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-200 px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Archivo recibido"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-800",children:m.fileName??"Adjunto"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[m.fileUrl&&e.jsx("a",{href:m.fileUrl,download:m.fileName||"archivo.pdf",className:"rounded-full border border-slate-200 px-4 py-2 text-xs font-semibold text-slate-600 hover:bg-slate-50",children:"Descargar"}),e.jsx("button",{onClick:()=>W(null),className:"rounded-full bg-slate-900 px-3 py-2 text-xs font-semibold text-white hover:bg-slate-700",children:"Cerrar"})]})]}),e.jsx("div",{className:"max-h-[75vh] overflow-auto px-6 py-4",children:m.fileUrl?(le=m.fileMime)!=null&&le.includes("pdf")||(re=m.fileName)!=null&&re.toLowerCase().endsWith(".pdf")?e.jsx("iframe",{title:"Vista previa del trabajo",src:m.fileUrl,className:"h-[70vh] w-full rounded-lg border border-slate-200"}):e.jsx("p",{className:"text-sm text-slate-600",children:"Este formato no se puede mostrar aquí; utiliza Descargar para revisarlo."}):e.jsx("p",{className:"text-sm text-slate-600",children:"El estudiante no adjuntó archivos."})})]})})]}):e.jsx("div",{children:"Acceso restringido al rol Docente."})};export{Ue as default};
