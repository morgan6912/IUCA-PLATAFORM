import{f as U,u as G,e as i,j as a,R as K,J as Q}from"./index-C4aqFuzc.js";const _=()=>{const{myCourses:u,loading:H}=U(),{user:b}=G(),[x,$]=i.useState([]),D={L:"Lunes",M:"Martes",X:"Miércoles",J:"Jueves",V:"Viernes",S:"Sábado",D:"Domingo"},l=["L","M","X","J","V","S","D"],L=(e,s)=>{const[o,t]=e.split(":");let r=parseInt(o,10);const c=t?parseInt(t,10):0,m=s.toLowerCase()==="pm";return m&&r<12&&(r+=12),!m&&r===12&&(r=0),r*60+c},n=30;i.useEffect(()=>{(async()=>{if(!b||b.role!==K.ESTUDIANTE)return;const s=b.id;try{const o=await Q(),t=[];for(const r of o)if((Array.isArray(r.studentIds)?r.studentIds:[]).includes(s)){t.push(r);continue}$(t)}catch{$([])}})()},[b]);const d=i.useMemo(()=>{const e=[];for(const r of u){const c=r.schedule.match(/([LMXJVSD](?:-[LMXJVSD])*)\s+(\d{1,2}(?::\d{2})?)\s*-\s*(\d{1,2}(?::\d{2})?)(am|pm)/i);if(!c)continue;const m=c[1].split("-"),w=c[2],h=c[3],p=c[4],f=L(w,p),M=L(h,p),y=Math.floor(f/n)*n,g=Math.ceil(M/n)*n,j=Math.max(1,(g-y)/n);for(const v of m)e.push({day:v,code:r.code,name:r.name,room:r.room,start:f,end:M,startRow:y,endRow:g,rows:j})}const s={Lunes:"L",Martes:"M",Miércoles:"X",Miercoles:"X",Jueves:"J",Viernes:"V",Sábado:"S",Sabado:"S",Domingo:"D"},o={Lu:"L",Ma:"M",Mi:"X",Ju:"J",Vi:"V",Sa:"S",Do:"D"},t=r=>{const[c,m]=r.split(":").map(Number);return c*60+(m||0)};return x.forEach(r=>{r.modulo.materias.forEach(c=>{Object.entries(c.horario).forEach(([m,w])=>{const h=s[m];if(!h&&m.toLowerCase()==="horario"){const S=w.match(/([A-Za-z]{2}(?:-[A-Za-z]{2})*)\s+(\d{1,2}:\d{2})\s*-\s*(\d{1,2}:\d{2})/);if(!S)return;const q=S[1].split("-"),X=t(S[2]),O=t(S[3]),k=Math.floor(X/n)*n,C=Math.ceil(O/n)*n,B=Math.max(1,(C-k)/n);q.forEach(I=>{const T=o[I]||s[I];T&&e.push({day:T,code:`${r.modulo.codigo}-${c.clave}`,name:c.nombre,start:X,end:O,startRow:k,endRow:C,rows:B})});return}if(!h)return;const[p,f]=w.split("-");if(!p||!f)return;const M=t(p),y=t(f),g=Math.floor(M/n)*n,j=Math.ceil(y/n)*n,v=Math.max(1,(j-g)/n);e.push({day:h,code:`${r.modulo.codigo}-${c.clave}`,name:c.nombre,start:M,end:y,startRow:g,endRow:j,rows:v})})})}),e},[u,x]),[R,J]=i.useMemo(()=>{const e=[480,1200];if(d.length===0)return e;let s=Math.min(...d.map(t=>t.start)),o=Math.max(...d.map(t=>t.end));return s=Math.max(480,Math.floor(s/n)*n),o=Math.min(1260,Math.ceil(o/n)*n),[s,o]},[d]),z=i.useMemo(()=>{const e=[];for(let s=R;s<=J;s+=n)e.push(s);return e},[R,J]),N=e=>{const s=Math.floor(e/60),o=e%60,t=s>=12?"pm":"am",r=(s+11)%12+1,c=o.toString().padStart(2,"0");return`${r}:${c}${t}`},F=i.useMemo(()=>{const e=new Map;return d.forEach(s=>e.set(`${s.day}-${s.startRow}`,s)),e},[d]),P=i.useMemo(()=>{const e=new Set;return d.forEach(s=>{for(let o=s.startRow+n;o<s.endRow;o+=n)e.add(`${s.day}-${o}`)}),e},[d]),V=e=>{const s=["bg-emerald-100 text-emerald-800 border-emerald-300","bg-sky-100 text-sky-800 border-sky-300","bg-amber-100 text-amber-800 border-amber-300","bg-violet-100 text-violet-800 border-violet-300","bg-rose-100 text-rose-800 border-rose-300","bg-teal-100 text-teal-800 border-teal-300"];let o=0;for(let t=0;t<e.length;t++)o=o*31+e.charCodeAt(t)>>>0;return s[o%s.length]},A=i.useMemo(()=>d.some(s=>s.day==="S"||s.day==="D")?l:l.slice(0,5),[d]),W=i.useMemo(()=>{switch(new Date().getDay()){case 0:return l.indexOf("D");case 6:return l.indexOf("S");case 5:return l.indexOf("V");case 4:return l.indexOf("J");case 3:return l.indexOf("X");case 2:return l.indexOf("M");case 1:default:return l.indexOf("L")}},[l]),E=l[W]??"L",Z=i.useMemo(()=>{const e={L:0,M:0,X:0,J:0,V:0,S:0,D:0};return d.forEach(s=>{const o=(s.end-s.start)/60;e[s.day]=(e[s.day]||0)+o}),e},[d]);return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx("h1",{className:"text-3xl font-bold text-slate-800",children:"Horario y Aulas"}),a.jsx("p",{className:"text-sm text-slate-500",children:"Visualiza tu semana académica con los bloques de clases y los módulos asignados."}),a.jsx("div",{className:"flex flex-wrap gap-3 text-xs text-slate-600",children:["L","M","X","J","V"].map(e=>{var s;return a.jsxs("span",{className:"bg-slate-100 px-3 py-1 rounded-full",children:[D[e]," • ",(s=Z[e])==null?void 0:s.toFixed(1),"h"]},e)})})]}),a.jsx("div",{className:"bg-white p-6 rounded-xl shadow-md",children:H?a.jsx("div",{children:"Cargando..."}):u.length===0&&x.length===0?a.jsx("p",{className:"text-slate-600",children:"Aún no tienes cursos ni módulos asignados."}):a.jsxs("div",{className:"overflow-x-auto",children:[a.jsxs("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"bg-slate-50",children:[a.jsx("th",{className:"px-3 py-2 text-left text-slate-600",children:"Hora"}),A.map(e=>{const s=E===e;return a.jsx("th",{className:`px-3 py-2 text-left text-slate-600 ${s?"text-iuca-blue-600":""}`,children:D[e]},e)})]})}),a.jsx("tbody",{className:"divide-y divide-slate-200",children:z.map(e=>a.jsxs("tr",{children:[a.jsx("td",{className:"px-3 py-2 text-slate-500 whitespace-nowrap align-top",children:N(e)}),A.map(s=>{const o=`${s}-${e}`,t=F.get(o);return t?a.jsx("td",{className:`px-3 py-2 align-top ${E===s?"bg-iuca-blue-50":""}`,rowSpan:t.rows,children:a.jsxs("div",{className:`border rounded p-2 h-full ${V(t.code)}`,style:{minHeight:`${t.rows*28}px`},children:[a.jsx("div",{className:"text-xs uppercase tracking-wide",children:t.code}),a.jsx("div",{className:"text-sm font-semibold",children:t.name}),a.jsxs("div",{className:"text-xs text-slate-700",children:[N(t.start)," - ",N(t.end)]}),t.room&&a.jsxs("div",{className:"text-xs",children:["Aula: ",t.room]})]})},o):P.has(o)?null:a.jsx("td",{className:"px-3 py-2 align-top"},o)})]},e))})]}),a.jsxs("div",{className:"mt-4 text-xs text-slate-500",children:["Fuente:"," ",[...u.map(e=>`${e.code} (${e.schedule})`),...x.map(e=>`${e.modulo.codigo} (módulo)`)].join(" • ")]}),a.jsxs("div",{className:"mt-4",children:[a.jsx("h3",{className:"text-sm font-semibold text-slate-700 mb-2",children:"Leyenda"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from(new Map([...u.map(e=>[e.code,e.name]),...x.flatMap(e=>e.modulo.materias.map(s=>[`${e.modulo.codigo}-${s.clave}`,s.nombre]))])).map(([e,s])=>a.jsxs("div",{className:`border rounded px-2 py-1 text-xs ${V(e)}`,children:[e," • ",s]},e))})]})]})})]})};export{_ as default};
