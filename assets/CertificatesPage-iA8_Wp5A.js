import{u as k,d as T,r as d,e as P,S as q,j as t,p as B,T as O,V as y,W}from"./index-C4aqFuzc.js";const G=a=>`${(a/1024).toFixed(2)} KB`,M=a=>{switch(a){case"aprobado":return"Aprobado";case"rechazado":return"Rechazado";default:return"Pendiente"}},K=a=>{switch(a){case"aprobado":return"bg-emerald-100 text-emerald-700 border border-emerald-300";case"rechazado":return"bg-rose-100 text-rose-700 border border-rose-300";default:return"bg-amber-100 text-amber-700 border border-amber-300"}},Q=["Acta de Nacimiento","Certificado de Estudios","Fotografía"],Y=()=>{const{user:a}=k(),{showToast:l}=T(),m=d.useRef(null),p=d.useRef(null),[c,x]=d.useState([]),[D,h]=d.useState(!1),[b,$]=d.useState("todos"),[g,j]=d.useState(null),f=P.useCallback(async()=>{if(!a){x([]);return}const e=await q(a.id);x(e)},[a]);d.useEffect(()=>{f()},[f]);const o=d.useMemo(()=>{const e=c.filter(r=>r.status==="pendiente").length,s=c.filter(r=>r.status==="aprobado").length,n=c.filter(r=>r.status==="rechazado").length;return{total:c.length,pending:e,approved:s,rejected:n}},[c]),A=[{id:"inscripcion",title:"Constancia de Inscripción",description:"Confirma tu matrícula formal en el periodo académico vigente."},{id:"documentos",title:"Resumen de Documentos",description:"Incluye el estado actual de todos los comprobantes que has subido."},{id:"avance",title:"Constancia de Avance Académico",description:"Repasa tus entregas, pendientes y últimas acciones del periodo."}],C=e=>{if(!a)return"";const s=new Date().toLocaleDateString();switch(e){case"documentos":return`Instituto Universitario de Ciencias Ambientales

Resumen de Documentos Adjuntos

Estudiante: ${a.name} (ID: ${a.id})
Documentos registrados: ${o.total}
Pendientes: ${o.pending}
Aprobados: ${o.approved}
Rechazados: ${o.rejected}

Fecha de emisión: ${s}
`;case"avance":return`Instituto Universitario de Ciencias Ambientales

Constancia de Avance Académico

Estudiante: ${a.name} (ID: ${a.id})
Documentos revisados: ${o.approved}
Documentos pendientes: ${o.pending}
Estado general: ${o.pending?"En revisión":"En regla"}

Fecha de emisión: ${s}
`;default:return`Instituto Universitario de Ciencias Ambientales

Constancia de Inscripción

Se certifica que ${a.name} (ID: ${a.id}) se encuentra inscrito/a en el periodo académico vigente.
Documentos pendientes: ${o.pending}

Fecha de emisión: ${s}
`}},R=e=>{if(!a)return;const s=C(e),n=new Blob([s],{type:"text/plain;charset=utf-8"}),r=URL.createObjectURL(n),u=document.createElement("a");u.href=r,u.download=`constancia-${e}.txt`,u.click(),URL.revokeObjectURL(r),l("Constancia generada correctamente","success")},N=async e=>{if(!(!a||!(e!=null&&e.length)))try{const s=await Promise.all(Array.from(e).map(r=>new Promise((u,v)=>{const i=new FileReader;i.onload=()=>u({name:r.name,size:r.size,type:r.type||"Documento",dataUrl:typeof i.result=="string"?i.result:void 0}),i.onerror=()=>v(new Error("No se pudo leer el archivo")),i.readAsDataURL(r)})));if(!s.length)return;const n=await y(a.id,a.name,s);x(n),l("Documentos agregados al proceso de inscripción.","success")}catch(s){l((s==null?void 0:s.message)||"No se pudieron cargar los archivos.","error")}finally{m.current&&(m.current.value=""),h(!1)}},S=async e=>{if(!(!a||!(e!=null&&e.length)||!g))try{const s=await Promise.all(Array.from(e).map(r=>new Promise((u,v)=>{const i=new FileReader;i.onload=()=>u({name:`${g} - ${r.name}`,size:r.size,type:r.type||g,dataUrl:typeof i.result=="string"?i.result:void 0}),i.onerror=()=>v(new Error("No se pudo leer el archivo")),i.readAsDataURL(r)}))),n=await y(a.id,a.name,s);x(n),l(`Documento cargado: ${g}`,"success")}catch(s){l((s==null?void 0:s.message)||"No se pudo cargar el archivo.","error")}finally{j(null),p.current&&(p.current.value="")}},E=e=>c.filter(s=>{var n;return(n=s.fileName)==null?void 0:n.startsWith(e)}).sort((s,n)=>new Date(n.uploadedAt).getTime()-new Date(s.uploadedAt).getTime())[0],F=e=>{e.preventDefault(),h(!1),N(e.dataTransfer.files)},U=()=>{if(!c.length){l("Añade al menos un archivo antes de enviar.","error");return}l("Documentos enviados para validación.","success")},I=async e=>{if(a){if(e.status!=="pendiente"){l("Sólo puedes eliminar documentos pendientes.","info");return}await W(e.id,a.id),await f(),l("Documento eliminado.","info")}},z=o.pending,w=b==="todos"?c:c.filter(e=>e.status===b),L=[{label:"Todos",value:"todos"},{label:"Pendientes",value:"pendiente"},{label:"Aprobados",value:"aprobado"},{label:"Rechazados",value:"rechazado"}];return a?t.jsxs("div",{className:"space-y-6",children:[t.jsx("h1",{className:"text-3xl font-bold text-slate-800",children:"Documentos académicos"}),t.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md space-y-3",children:[t.jsx("p",{className:"text-slate-600",children:"Descarga constancias y certificados académicos."}),t.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:A.map(e=>t.jsxs("div",{className:"rounded-2xl border border-slate-100 p-4 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm uppercase tracking-wide text-slate-400",children:"Documento"}),t.jsx("p",{className:"text-lg font-semibold text-slate-800",children:e.title})]}),t.jsx("span",{className:"text-xs font-semibold text-iuca-blue-600",children:"Instantánea"})]}),t.jsx("p",{className:"mt-2 text-sm text-slate-500",children:e.description}),t.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[t.jsxs("span",{className:"text-xs text-slate-400",children:[e.id==="documentos"&&`${o.total} archivo(s)`,e.id==="avance"&&`${o.approved} aprobados`,e.id==="inscripcion"&&`${z} pendientes`]}),t.jsx("button",{type:"button",onClick:()=>R(e.id),className:"rounded-full bg-gradient-to-r from-iuca-blue-600 to-iuca-green-600 px-3 py-1 text-xs font-semibold text-white shadow-sm shadow-slate-300 transition hover:opacity-90",children:"Descargar"})]})]},e.id))})]}),t.jsxs("section",{className:`${B} space-y-5`,children:[t.jsxs("header",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-lg font-semibold text-slate-800",children:"Documentos del proceso de inscripción"}),t.jsx("p",{className:"text-sm text-slate-500",children:"Adjunta los comprobantes, formularios o autorizaciones requeridas para tu matrícula. La administración validará los archivos y te notificará el estado."})]}),t.jsx("button",{type:"button",onClick:()=>{var e;return(e=m.current)==null?void 0:e.click()},className:`${O} bg-iuca-green-600 hover:bg-iuca-green-700`,children:"Seleccionar archivos"})]}),t.jsx("input",{ref:m,type:"file",multiple:!0,className:"hidden",onChange:e=>N(e.target.files)}),t.jsx("input",{ref:p,type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:e=>S(e.target.files)}),t.jsx("div",{className:"grid gap-3 md:grid-cols-3",children:Q.map(e=>{const s=E(e);return t.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm space-y-2",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-emerald-600",children:e}),t.jsx("p",{className:"text-xs text-slate-500",children:e==="Fotografía"?"Imagen reciente en fondo claro.":"Sube un archivo claro y legible."}),s&&t.jsxs("p",{className:"text-xs text-slate-500",children:["Último: ",s.fileName," (",new Date(s.uploadedAt).toLocaleDateString(),")"]}),t.jsxs("button",{type:"button",onClick:()=>{var n;j(e),(n=p.current)==null||n.click()},className:"inline-flex items-center justify-center rounded-xl bg-gradient-to-r from-iuca-green-600 to-iuca-blue-600 px-3 py-2 text-xs font-semibold text-white shadow hover:opacity-90",children:["Subir ",e.toLowerCase()]})]},e)})}),t.jsxs("div",{onDragOver:e=>{e.preventDefault(),h(!0)},onDragLeave:()=>h(!1),onDrop:F,className:`rounded-2xl border-2 p-6 transition ${D?"border-iuca-green-500 bg-iuca-green-50":"border-dashed border-slate-200 bg-slate-50"}`,children:[t.jsx("p",{className:"text-sm text-slate-500",children:"Arrastra tus archivos aquí o usa el botón superior."}),t.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"PDF, Word, Excel o imágenes (máx. 5 MB por archivo)."})]}),t.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[t.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4",children:[t.jsx("p",{className:"text-xs uppercase text-slate-400",children:"Documentos cargados"}),t.jsx("p",{className:"text-2xl font-semibold text-slate-800",children:o.total}),t.jsx("p",{className:"text-sm text-slate-500",children:"archivos en el historial"})]}),t.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4",children:[t.jsx("p",{className:"text-xs uppercase text-slate-400",children:"Pendientes"}),t.jsx("p",{className:"text-2xl font-semibold text-amber-600",children:o.pending}),t.jsx("p",{className:"text-sm text-slate-500",children:"bajo revisión"})]}),t.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4",children:[t.jsx("p",{className:"text-xs uppercase text-slate-400",children:"Aprobados"}),t.jsx("p",{className:"text-2xl font-semibold text-emerald-600",children:o.approved}),t.jsx("p",{className:"text-sm text-slate-500",children:"listos para la administración"})]})]}),t.jsx("div",{className:"flex flex-wrap gap-2 text-xs font-semibold uppercase",children:L.map(e=>t.jsx("button",{type:"button",onClick:()=>$(e.value),className:`rounded-full border px-3 py-1 transition ${b===e.value?"border-slate-900 bg-slate-900 text-white":"border-slate-200 bg-white text-slate-500 hover:border-slate-300"}`,children:e.label},e.value))}),w.length>0?t.jsx("ul",{className:"space-y-3",children:w.map(e=>t.jsxs("li",{className:"flex flex-col gap-3 rounded-xl border border-slate-100 bg-white px-4 py-3 shadow-sm sm:flex-row sm:items-center sm:justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-semibold text-slate-800",children:e.fileName}),t.jsxs("p",{className:"text-xs text-slate-500",children:[G(e.size)," · ",e.type," · ",new Date(e.uploadedAt).toLocaleString()]}),t.jsx("span",{className:`inline-flex items-center gap-1 rounded-full px-3 py-1 mt-2 text-xs font-semibold ${K(e.status)}`,children:M(e.status)})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[t.jsx("button",{type:"button",onClick:()=>I(e),className:"px-3 py-1 rounded-full border border-slate-200 text-slate-500 hover:border-slate-300 hover:text-slate-800 transition disabled:opacity-50 disabled:pointer-events-none",disabled:e.status!=="pendiente",children:"Eliminar"}),e.status!=="pendiente"&&e.reviewerName&&t.jsxs("p",{className:"text-xs text-slate-400",children:["Revisado por ",e.reviewerName," ",e.reviewedAt?`el ${new Date(e.reviewedAt).toLocaleString()}`:""]})]})]},e.id))}):t.jsx("p",{className:"text-sm text-slate-500",children:b==="todos"?"Todavía no has agregado archivos.":"No hay archivos registrados con ese estado."}),t.jsx("div",{className:"text-right",children:t.jsx("button",{type:"button",onClick:U,className:"inline-flex items-center gap-2 rounded-full px-6 py-2 text-sm font-semibold text-white bg-slate-900 hover:bg-slate-800 transition",children:"Guardar documentos"})})]})]}):t.jsx("div",{children:"Inicia sesión."})};export{Y as default};
