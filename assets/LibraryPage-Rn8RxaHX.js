import{c as X,r as h,m as Re,n as Te,u as Me,R as ue,e as i,j as e,p as ze,o as Be,q as Ue}from"./index-C4aqFuzc.js";import{u as $e}from"./useLibraryRequests-DhHk1sIu.js";import{D as pe}from"./download-lqvHWmM-.js";/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],Oe=X("bookmark",_e);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],qe=X("funnel",Ve);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],He=X("search",Ge),be="iuca-lib-favs",ee=()=>{try{const r=localStorage.getItem(be);return r?JSON.parse(r):[]}catch{return[]}},Ke=r=>localStorage.setItem(be,JSON.stringify(r)),Ye=()=>ee(),Je=r=>ee().includes(r),We=r=>{const n=new Set(ee());n.has(r)?n.delete(r):n.add(r);const C=Array.from(n);return Ke(C),n.has(r)},Qe=()=>{const[r,n]=h.useState([]),[C,G]=h.useState([]),[T,j]=h.useState(!0),[N,k]=h.useState(""),[v,H]=h.useState("all"),[A,K]=h.useState(!1),[F,P]=h.useState(1),y=8,L=h.useCallback(async()=>{j(!0);const[x,o]=await Promise.all([Re(),Te()]);n(x),G(["all",...o]),j(!1)},[]);h.useEffect(()=>{L()},[L]);const w=h.useMemo(()=>{const x=N.toLowerCase(),o=new Set(Ye());return r.filter(p=>{const B=p.title.toLowerCase().includes(x)||p.author.toLowerCase().includes(x),D=v==="all"||p.category===v,g=!A||o.has(p.id);return B&&D&&g})},[r,N,v,A]),M=w.length,d=Math.max(1,Math.ceil(M/y)),z=h.useMemo(()=>{const x=(F-1)*y;return w.slice(x,x+y)},[w,F]);return{documents:r,filteredDocuments:w,page:F,setPage:P,perPage:y,total:M,totalPages:d,paginated:z,categories:C,loading:T,searchTerm:N,setSearchTerm:k,category:v,setCategory:H,favoritesOnly:A,setFavoritesOnly:K,toggleFav:x=>We(x),isFav:x=>Je(x),refreshDocuments:L}},he=r=>{const n=r.toLowerCase();return n.includes("cambio")||n.includes("clim")?"bg-gradient-to-br from-cyan-600 to-cyan-400":n.includes("gest")||n.includes("admin")?"bg-gradient-to-br from-sky-700 to-sky-400":n.includes("conserv")||n.includes("eco")?"bg-gradient-to-br from-emerald-700 to-emerald-400":n.includes("tesis")?"bg-gradient-to-br from-amber-600 to-amber-400":"bg-gradient-to-br from-emerald-700 to-cyan-600"},tt=()=>{const{filteredDocuments:r,documents:n,paginated:C,total:G,totalPages:T,page:j,setPage:N,categories:k,loading:v,searchTerm:H,setSearchTerm:A,category:K,setCategory:F,favoritesOnly:P,setFavoritesOnly:y,toggleFav:L,isFav:w,refreshDocuments:M}=Qe(),{user:d}=Me(),z=(d==null?void 0:d.role)===ue.BIBLIOTECARIO,b=(d==null?void 0:d.role)===ue.ESTUDIANTE,[Y,x]=i.useState(!1),[o,p]=i.useState({title:"",author:"",category:"",publishDate:"",url:""}),[B,D]=i.useState(""),[g,U]=i.useState("idle"),[u,$]=i.useState(null),[te,_]=i.useState(""),[ge,I]=i.useState(!1),[fe,J]=i.useState(0),[se,f]=i.useState(""),[je,ae]=i.useState(null),[c,W]=i.useState(null),{requests:S,createRequest:le,updateStatus:Ne}=$e(),[re,ie]=i.useState(null),[ve,ne]=i.useState(null),ye=async t=>{if(t.preventDefault(),!o.title.trim()||!o.author.trim()||!o.category.trim()){U("error"),D("Completa título, autor y categoría antes de guardar.");return}x(!0),U("idle"),D("");const a=(u==null?void 0:u.dataUrl)||o.url.trim()||"#",l={title:o.title.trim(),author:o.author.trim(),category:o.category.trim(),publishDate:o.publishDate?new Date(o.publishDate).toISOString():new Date().toISOString(),url:a,fileName:u==null?void 0:u.name,fileType:u?"application/pdf":void 0};try{const s=await Be(l);U("success"),D("Libro agregado correctamente."),p({title:"",author:"",category:"",publishDate:"",url:""}),Q(),W(s),await M()}catch(s){console.error(s),U("error"),D("No se pudo guardar el libro. Intenta de nuevo.")}finally{x(!1)}},Q=()=>{$(null),_(""),I(!1),J(t=>t+1)},we=t=>{var s;const a=(s=t.target.files)==null?void 0:s[0];if(!a){Q();return}if(a.type!=="application/pdf"){_("Solo se pueden subir archivos PDF."),$(null),I(!1),J(m=>m+1);return}I(!0),_("");const l=new FileReader;l.onload=()=>{typeof l.result=="string"&&($({name:a.name,dataUrl:l.result}),I(!1))},l.onerror=()=>{_("No se pudo leer el PDF."),I(!1),$(null),J(m=>m+1)},l.readAsDataURL(a)},De=i.useCallback(async t=>{if(!d)return;const a=S.find(l=>l.documentId===t.id&&l.userId===d.id);if(a&&a.status==="pending"){f("Tu solicitud ya está en revisión.");return}f(""),ae(t.id);try{await le(t,d),f("Solicitud enviada. Espera respuesta del bibliotecario.")}catch(l){console.error(l),f("No se pudo enviar la solicitud. Intenta más tarde.")}finally{ae(null)}},[S,d,le]),oe=async(t,a)=>{ie(t);try{await Ne(t,a)}catch(l){console.error(l)}finally{ie(null)}},Se=async(t,a)=>{if(!a||!!!(t.url&&t.url!=="#"))return;const s=window.open("about:blank","_blank");s?(s.document.title="Generando descarga...",s.document.body.innerHTML='<p style="font-family:sans-serif;padding:16px">Generando enlace seguro...</p>'):f("Permite las ventanas emergentes para descargar."),ne(t.id);try{if(t.fileName){const m=await Ue(t.id);m?s?s.location.href=m:window.location.href=m:(f("No se pudo generar el enlace de descarga."),s==null||s.close())}else t.url&&t.url!=="#"&&(s?s.location.href=t.url:window.location.href=t.url)}catch(m){console.error(m),f("No se pudo abrir el archivo."),s==null||s.close()}finally{ne(null)}},[O,Ce]=i.useState(""),[ce,ke]=i.useState([]),[de,xe]=i.useState(!1),Ae=()=>{O.trim()&&(xe(!0),setTimeout(()=>{const t=O.toLowerCase().split(/\W+/).filter(Boolean),a=n.map(l=>{const s=`${l.title} ${l.author} ${l.category}`.toLowerCase();return{score:t.reduce((E,V)=>E+(s.includes(V)?1:0),0),doc:l}}).filter(({score:l})=>l>0).sort((l,s)=>s.score-l.score||l.doc.title.localeCompare(s.doc.title)).map(({doc:l})=>l).slice(0,3);ke(a.length?a:n.slice(0,3)),xe(!1)},400))},[Z,Fe]=i.useState("date-desc"),me=i.useMemo(()=>{const t=[...r];return Z==="title-asc"?t.sort((a,l)=>a.title.localeCompare(l.title)):t.sort((a,l)=>new Date(l.publishDate).getTime()-new Date(a.publishDate).getTime()),t},[r,Z]),Pe=i.useMemo(()=>new Set(r.map(t=>t.author)).size,[r]);return v?e.jsx("div",{className:"p-6",children:"Cargando biblioteca..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("section",{className:"rounded-2xl p-8 text-white shadow-md bg-gradient-to-r from-emerald-700 to-sky-700",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Biblioteca Digital IUCA"}),e.jsx("p",{children:"Accede a miles de recursos académicos y materiales de estudio."})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"text-center bg-white/15 backdrop-blur rounded-xl px-6 py-3 min-w-[120px]",children:[e.jsx("p",{className:"text-2xl font-bold",children:G}),e.jsx("p",{className:"text-xs opacity-90",children:"Documentos"})]}),e.jsxs("div",{className:"text-center bg-white/15 backdrop-blur rounded-xl px-6 py-3 min-w-[120px]",children:[e.jsx("p",{className:"text-2xl font-bold",children:Pe}),e.jsx("p",{className:"text-xs opacity-90",children:"Autores"})]}),e.jsxs("div",{className:"text-center bg-white/15 backdrop-blur rounded-xl px-6 py-3 min-w-[120px]",children:[e.jsx("p",{className:"text-2xl font-bold",children:Math.max(0,k.length-1)}),e.jsx("p",{className:"text-xs opacity-90",children:"Categorías"})]})]})]})}),c&&e.jsxs("section",{className:"rounded-2xl border border-emerald-100 bg-white p-6 shadow-sm space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-emerald-500",children:"Vista previa"}),e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-start md:justify-between md:gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-900",children:c.title}),e.jsx("p",{className:"text-sm text-slate-500",children:c.author})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-slate-500",children:c.fileName?"PDF cargado":c.url&&c.url!=="#"?"Enlace externo":"Sin archivo"}),e.jsx("button",{type:"button",onClick:()=>W(null),className:"text-xs font-semibold text-emerald-600 hover:text-emerald-500",children:"Cerrar vista previa"})]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[240px_1fr]",children:[e.jsxs("div",{className:"space-y-2 rounded-2xl border border-slate-100 bg-slate-50 p-4",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:"Detalles"}),e.jsx("p",{className:"text-sm font-semibold text-slate-800",children:c.category}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Publicado: ",new Date(c.publishDate).toLocaleDateString("es-ES")]}),e.jsxs("p",{className:"text-xs text-slate-500",children:["ID: ",c.id]}),c.fileName&&e.jsxs("p",{className:"text-xs text-slate-500",children:["Archivo: ",c.fileName]}),!c.url||c.url==="#"?e.jsx("p",{className:"text-xs text-rose-500",children:"No hay archivo disponible aún."}):c.fileName?e.jsx("p",{className:"text-xs text-slate-500",children:"Enlace interno (PDF)"}):e.jsx("p",{className:"text-xs text-slate-500",children:"Enlace externo disponible"})]}),e.jsx("div",{className:"rounded-2xl border border-slate-100 overflow-hidden bg-slate-50 h-[320px]",children:(()=>{const t=c.url;return(c.fileType==="application/pdf"||(t==null?void 0:t.startsWith("data:application/pdf")))&&t?e.jsx("object",{data:t,type:"application/pdf",className:"w-full h-full","aria-label":`PDF preview ${c.title}`,children:e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-4",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"El navegador no puede mostrar el PDF."}),e.jsx("a",{href:t,target:"_blank",rel:"noreferrer",className:"text-xs text-emerald-600 underline mt-2",children:"Abrir documento en nueva pestaña"})]})}):t&&t!=="#"?e.jsxs("div",{className:"flex flex-col items-center justify-center text-center h-full px-6",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"Vista previa no disponible para enlaces externos."}),e.jsx("a",{href:t,target:"_blank",rel:"noreferrer",className:"text-xs text-emerald-600 underline mt-2",children:"Abrir recurso"})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-center h-full px-6",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"Sube un PDF para ver la vista previa."}),e.jsx("p",{className:"text-xs text-slate-500",children:"Solo los archivos PDF se renderizan directamente."})]})})()})]})]}),se&&e.jsx("div",{className:"rounded-2xl border border-emerald-100 bg-emerald-50 px-4 py-3 text-sm text-emerald-700",children:se}),z&&e.jsxs("section",{className:"rounded-3xl border border-emerald-200 bg-white p-6 shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-emerald-500",children:"Solicitudes de estudiantes"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Revisar y autorizar"})]}),e.jsxs("span",{className:"text-sm text-slate-500",children:["Total: ",S.length]})]}),S.length===0?e.jsx("p",{className:"text-sm text-slate-500",children:"No hay solicitudes pendientes."}):e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:S.map(t=>e.jsxs("article",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Doc"}),e.jsx("h4",{className:"text-sm font-semibold text-slate-900",children:t.documentTitle}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Usuario: ",t.userName]})]}),e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-[0.3em] text-slate-500",children:t.status})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:["Solicitado: ",new Date(t.requestedAt).toLocaleString("es-ES")]}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>oe(t.id,"approved"),disabled:re===t.id,className:"flex-1 rounded-xl bg-emerald-600 px-3 py-2 text-sm font-semibold text-white hover:opacity-90 disabled:opacity-60",children:"Aprobar"}),e.jsx("button",{type:"button",onClick:()=>oe(t.id,"denied"),disabled:re===t.id,className:"flex-1 rounded-xl border border-rose-300 bg-white px-3 py-2 text-sm font-semibold text-rose-600 hover:bg-rose-50 disabled:opacity-60",children:"Rechazar"})]})]},t.id))})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsxs("div",{className:"relative md:flex-1",children:[e.jsx(He,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar libros, artículos, autores, temas...",value:H,onChange:t=>A(t.target.value),className:"w-full p-3 pl-10 border border-slate-200 rounded-xl shadow-sm focus:ring-emerald-600 focus:border-emerald-600"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>y(!P),className:"inline-flex items-center gap-2 px-4 py-3 rounded-xl border shadow-sm "+(P?"bg-emerald-600 text-white border-emerald-600":"bg-white border-slate-200"),children:[e.jsx(Oe,{className:"w-4 h-4"})," ",P?"Solo favoritos":"Todos"]}),e.jsxs("span",{className:"inline-flex items-center gap-2 px-4 py-3 rounded-xl border bg-white border-slate-200 text-slate-700 shadow-sm",children:[e.jsx(qe,{className:"w-4 h-4"})," Filtros"]}),e.jsxs("select",{value:Z,onChange:t=>Fe(t.target.value),className:"px-3 py-2 rounded-xl border bg-white border-slate-200 text-slate-700 shadow-sm",children:[e.jsx("option",{value:"date-desc",children:"Más recientes"}),e.jsx("option",{value:"title-asc",children:"Título (A-Z)"})]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:k.map(t=>e.jsx("button",{onClick:()=>F(t),className:"inline-flex items-center gap-2 px-4 py-2 rounded-full border text-sm shadow-sm transition "+(K===t?"bg-gradient-to-r from-emerald-700 to-emerald-400 text-white border-emerald-600":"bg-white text-slate-700 border-slate-200 hover:border-emerald-600 hover:text-emerald-700"),children:t==="all"?"Todos":t},t))}),e.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-5 shadow-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:"Asistente bibliotecaria"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-800",children:"Descríbeme tus necesidades"})]}),e.jsx("p",{className:"text-sm text-slate-500 max-w-sm",children:"Dime si buscas libros específicos, temas, autores o formatos y recibirás recomendaciones instantáneas."})]}),e.jsxs("div",{className:"mt-4 flex flex-col gap-3",children:[e.jsx("textarea",{rows:2,value:O,onChange:t=>Ce(t.target.value),placeholder:"Ej: Necesito libros sobre conservación del agua con muchos gráficos y datos",className:"w-full rounded-2xl border border-slate-200 p-3 text-sm focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("button",{type:"button",onClick:Ae,className:"inline-flex items-center justify-center rounded-2xl bg-gradient-to-r from-iuca-green-600 to-iuca-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-lg hover:opacity-90 disabled:opacity-50",disabled:de||!O.trim(),children:de?"Buscando...":"Preguntar"}),e.jsx("span",{className:"text-xs text-slate-500",children:"No uses datos sensibles. Esta asistente sugiere títulos que ya están en la biblioteca."})]})]}),ce.length>0&&e.jsx("div",{className:"mt-6 grid gap-3 md:grid-cols-3",children:ce.map(t=>e.jsxs("article",{className:"rounded-2xl border border-slate-100 bg-slate-50 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:t.category}),e.jsx("h4",{className:"mt-2 text-sm font-semibold text-slate-900",children:t.title}),e.jsx("p",{className:"text-xs text-slate-500",children:t.author}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:new Date(t.publishDate).getFullYear()})]},t.id))})]})]}),z&&e.jsxs("section",{className:"rounded-3xl border border-emerald-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-emerald-500",children:"Bibliotecaria IUCA"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Agrega un libro o documento nuevo"})]}),e.jsx("span",{className:"text-sm font-medium "+(g==="success"?"text-emerald-600":g==="error"?"text-rose-500":"text-slate-500"),children:g==="success"?"Recurso guardado":g==="error"?"Hay un problema":"Completa los campos y presiona guardar"})]}),e.jsxs("form",{onSubmit:ye,className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:[e.jsx("input",{type:"text",placeholder:"Título",value:o.title,onChange:t=>p(a=>({...a,title:t.target.value})),className:"rounded-2xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:ring-1 focus:ring-emerald-200",required:!0}),e.jsx("input",{type:"text",placeholder:"Autor",value:o.author,onChange:t=>p(a=>({...a,author:t.target.value})),className:"rounded-2xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:ring-1 focus:ring-emerald-200",required:!0}),e.jsx("input",{type:"text",placeholder:"Categoría",value:o.category,onChange:t=>p(a=>({...a,category:t.target.value})),className:"rounded-2xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:ring-1 focus:ring-emerald-200",required:!0}),e.jsx("input",{type:"date",placeholder:"Fecha de publicación",value:o.publishDate,onChange:t=>p(a=>({...a,publishDate:t.target.value})),className:"rounded-2xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:ring-1 focus:ring-emerald-200"})]}),e.jsx("input",{type:"url",placeholder:"URL del archivo (opcional)",value:o.url,onChange:t=>p(a=>({...a,url:t.target.value})),disabled:!!u,title:u?"Ya hay un archivo PDF cargado":"Ingresa un enlace público",className:`w-full rounded-2xl border px-3 py-2 text-sm focus:border-emerald-500 focus:ring-1 focus:ring-emerald-200 ${u?"border-slate-200 bg-slate-100 text-slate-400 cursor-not-allowed":"border-slate-200 bg-white text-slate-700"}`}),e.jsx("p",{className:"text-xs text-slate-500",children:"El campo URL se ignora cuando se sube un PDF. Deja el archivo en blanco si quieres enlazar un recurso externo."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Adjuntar PDF"}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:we,className:"w-full text-sm text-slate-600 file:cursor-pointer file:rounded-2xl file:border file:border-slate-300 file:px-3 file:py-2 file:text-sm file:font-semibold file:text-slate-600 file:bg-white"},fe),ge&&e.jsx("p",{className:"text-xs text-slate-500",children:"Procesando PDF..."}),te&&e.jsx("p",{className:"text-xs text-rose-600",children:te}),u&&e.jsxs("div",{className:"flex items-center justify-between rounded-2xl bg-slate-50 px-3 py-2 text-xs text-slate-600",children:[e.jsx("span",{className:"truncate",children:u.name}),e.jsx("button",{type:"button",onClick:Q,className:"text-slate-900 font-semibold underline",children:"Cambiar"})]})]}),B&&e.jsx("p",{className:`text-sm ${g==="error"?"text-rose-600":"text-emerald-600"}`,children:B}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:Y,className:"inline-flex items-center gap-2 rounded-2xl bg-gradient-to-r from-emerald-600 to-sky-600 px-4 py-2 text-sm font-semibold text-white shadow-lg hover:opacity-90 disabled:opacity-60",children:Y?"Guardando...":"Guardar en la biblioteca"})})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"flex items-center gap-2 text-emerald-700 font-semibold",children:"Recursos Destacados"}),e.jsx("div",{className:"text-emerald-700 font-semibold text-sm cursor-pointer",children:"Ver todos →"})]}),e.jsx("div",{className:`grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 ${ze} p-6`,children:me.slice(0,4).map(t=>{const a=!!(t.url&&t.url!=="#"||t.fileName),l=b?S.filter(R=>R.documentId===t.id):[],s=b&&d?l.find(R=>R.userId===d.id):void 0,m=b?l.filter(R=>R.status==="pending").length:0,E=b&&je===t.id,V=ve===t.id,Le=b?E?"Enviando...":s?s.status==="approved"?"Solicitud aprobada":s.status==="pending"?"Solicitud pendiente":"Solicitud rechazada":"Solicitar autorizacion":"",q=a&&(!b||(s==null?void 0:s.status)==="approved"),Ie=b?s?s.status==="approved"?"Autorizado":s.status==="pending"?"Solicitar libro":"Solicitud rechazada":"Solicitar libro":a?"Descarga directa":"Recurso pendiente",Ee=b?(s==null?void 0:s.status)==="approved"?"bg-emerald-100 text-emerald-700 border-emerald-200":(s==null?void 0:s.status)==="pending"||!s?"bg-amber-100 text-amber-700 border-amber-200":"bg-rose-100 text-rose-700 border-rose-200":a?"bg-emerald-100 text-emerald-700 border-emerald-200":"bg-amber-100 text-amber-700 border-amber-200";return e.jsxs("div",{className:"bg-white rounded-2xl overflow-hidden border border-black/5 shadow-sm hover:shadow-lg transition",children:[e.jsxs("div",{className:"h-40 flex items-center justify-center relative "+he(t.category),children:[e.jsx("div",{className:"absolute inset-0 bg-black/10"}),e.jsx("svg",{className:"w-16 h-16 text-white drop-shadow-md",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"})})]}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("span",{className:"inline-block text-[11px] font-bold uppercase tracking-wide bg-emerald-50 text-emerald-700 rounded-full px-2 py-0.5",children:t.category}),e.jsx("span",{className:`text-[11px] font-semibold uppercase tracking-wide rounded-full px-2 py-0.5 border ${Ee}`,children:Ie})]}),e.jsx("h4",{className:"text-slate-900 font-semibold leading-snug line-clamp-2",children:t.title}),e.jsx("p",{className:"text-slate-600 text-sm",children:t.author}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("button",{type:"button",disabled:!a||!q||V,onClick:()=>a&&Se(t,q),className:`inline-flex items-center justify-center gap-2 px-3 py-2 rounded-lg font-semibold ${a&&q?"text-white bg-gradient-to-r from-emerald-700 to-emerald-500 hover:shadow-md":"bg-slate-200 text-slate-500 cursor-not-allowed"}`,children:[e.jsx(pe,{className:"w-4 h-4"}),V?"Generando enlace...":a?q?"Descargar PDF":"Solicitar autorizacion":"Sin archivo disponible"]}),e.jsx("button",{type:"button",onClick:()=>W(t),className:"text-xs font-semibold text-emerald-600 hover:text-emerald-500 text-left underline",children:"Ver vista previa"})]}),b&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("button",{type:"button",onClick:()=>De(t),disabled:!!(s&&s.status==="pending")||E,className:`w-full rounded-lg border px-3 py-2 text-xs font-semibold uppercase tracking-[0.3em] transition ${s&&s.status==="approved"?"border-emerald-500 bg-emerald-50 text-emerald-600":"border-slate-200 bg-white text-slate-700"}`,children:E?"Enviando...":Le}),s&&e.jsx("p",{className:"text-xs text-slate-500",children:s.status==="pending"?"Tu solicitud está en revisión.":s.status==="approved"?"Bibliotecario autorizado.":"Tu solicitud fue rechazada."}),m>0&&e.jsxs("p",{className:"text-xs text-slate-500",children:[m," solicitud",m===1?"":"es"," pendientes para este documento."]})]})]}),t.fileName?e.jsxs("p",{className:"text-xs text-slate-500",children:["Archivo: ",t.fileName]}):a?e.jsx("p",{className:"text-xs text-slate-500",children:"Enlace externo"}):e.jsx("p",{className:"text-xs text-rose-500",children:"Recurso pendiente"})]})]},t.id)})})]}),e.jsxs("section",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-100 p-5",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"Biblioteca por categoría"}),e.jsx("ul",{className:"space-y-2 text-sm text-slate-600",children:k.filter(t=>t!=="all").slice(0,6).map(t=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:t}),e.jsx("span",{children:r.filter(a=>a.category===t).length})]},t))})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-100 p-5",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3",children:"Lecturas destacadas"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Explora resúmenes, descargas y recursos complementarios para profundizar tus conocimientos en ciencias ambientales."})]})]}),e.jsxs("section",{className:"bg-white rounded-2xl border border-slate-100 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Resultados (",me.length,")"]}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Página ",j," de ",T]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:C.map(t=>e.jsxs("div",{className:"border border-slate-100 rounded-2xl p-4 flex gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-white "+he(t.category),children:e.jsx(pe,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-800",children:t.title}),e.jsx("p",{className:"text-xs text-slate-500",children:t.author}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-slate-500",children:[e.jsx("span",{children:t.category}),e.jsx("button",{onClick:()=>L(t.id),className:"underline",children:w(t.id)?"Eliminar favorito":"Agregar favorito"})]})]})]},t.id))}),e.jsxs("div",{className:"mt-6 flex items-center justify-between text-sm text-slate-500",children:[e.jsx("button",{onClick:()=>N(Math.max(1,j-1)),className:"px-3 py-2 border rounded-full",children:"Anterior"}),e.jsx("button",{onClick:()=>N(Math.min(T,j+1)),className:"px-3 py-2 border rounded-full",children:"Siguiente"})]})]})]})};export{tt as default};
